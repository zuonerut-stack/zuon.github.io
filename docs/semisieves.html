<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Matrix Sieve Simulation</title>
<style>
  body { font-family: monospace; background: #f9f9f9; padding: 20px; }
  table { border-collapse: collapse; margin-bottom: 10px; }
  td { border: 1px solid #aaa; padding: 4px 8px; text-align: center; }
  .x { background: #ffcccc; color: red; font-weight: bold; }
  .stage { margin-bottom: 25px; }
</style>
</head>
<body>

<h2>Matrix Sieve Simulation</h2>
<label>Enter a positive integer (n): </label>
<input id="numInput" type="number" min="1">
<button onclick="runSieve()">Run</button>

<div id="output"></div>

<script>
function makeMatrix(n) {
  const rows = [];
  let N = Math.floor(n / 2);
  let num = 1;
  if (n % 2 === 0) {
    // even n → 2 rows of N elements each
    rows.push(Array.from({length: N}, (_, i) => num++));
    rows.push(Array.from({length: N}, (_, i) => num++));
  } else {
    // odd n → 3rd row single last element
    rows.push(Array.from({length: N}, (_, i) => num++));
    rows.push(Array.from({length: N}, (_, i) => num++));
    rows.push([num]);
  }
  return rows;
}

function flatten(mat) {
  return mat.flat();
}

function toTable(mat) {
  let html = '<table>';
  for (const r of mat) {
    html += '<tr>' + r.map(v => 
      v === 'X' ? `<td class="x">X</td>` : `<td>${v}</td>`).join('') + '</tr>';
  }
  html += '</table>';
  return html;
}

function runSieve() {
  const n = parseInt(document.getElementById('numInput').value);
  if (!n || n < 1) return alert("Please enter a valid positive integer.");
  const out = document.getElementById('output');
  out.innerHTML = "";

  // Initialize matrix
  let mat = makeMatrix(n);
  let stage = 1;
  let lastNum = n % 2 === 0 ? n : n - 1; // last number in initial table

  while (flatten(mat).length > 2) {
    // display current matrix
    const stageDiv = document.createElement('div');
    stageDiv.className = 'stage';
    stageDiv.innerHTML = `<b>Stage ${stage}:</b><br>${toTable(mat)}`;
    out.appendChild(stageDiv);

    const flat = flatten(mat);
    const maxNum = Math.max(...flat.filter(v => typeof v === 'number'));
    // mark the largest as X
    const nextFlat = flat.map(v => (v === maxNum ? 'X' : v));

    // move X to front
    const idx = nextFlat.indexOf('X');
    if (idx > -1) {
      nextFlat.splice(idx, 1);
      nextFlat.unshift('X');
    }

    // reshape smaller matrix
    const newCols = Math.floor(nextFlat.filter(v => v !== 'X').length / mat.length);
    const newMat = [];
    let temp = nextFlat.slice();
    while (temp.length) {
      newMat.push(temp.splice(0, newCols));
    }
    mat = newMat;
    stage++;
  }

  // final stage
  const stageDiv = document.createElement('div');
  stageDiv.className = 'stage';
  stageDiv.innerHTML = `<b>Final Stage:</b><br>${toTable(mat)}`;
  out.appendChild(stageDiv);

  // show sieved numbers
  const remain = flatten(mat).filter(v => v !== 'X');
  out.innerHTML += `<hr><b>The sieved numbers are:</b> ${remain.join(', ')}`;
}
</script>
</body>
</html>


